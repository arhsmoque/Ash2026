<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ASH 2026 Photo Book - LIVE & SHARED</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        button { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        input, button, textarea { font-size: 16px; }
        .trim-slider { -webkit-appearance: none; appearance: none; height: 8px; background: #ddd; border-radius: 4px; outline: none; }
        .trim-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #667eea; border-radius: 50%; cursor: pointer; }
        .admin-badge { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); }
        .locked { filter: grayscale(100%); opacity: 0.7; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useEffect, useRef } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyB8j-jHo2N341ieW4AVCdPL3ipn4Ss8sYQ",
            authDomain: "ash-2026-photobook.firebaseapp.com",
            projectId: "ash-2026-photobook",
            storageBucket: "ash-2026-photobook.firebasestorage.app",
            messagingSenderId: "328228907150",
            appId: "1:328228907150:web:fb4d2780b40bb8403ec1df",
            measurementId: "G-783K226XC4"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const CLOUDINARY_CLOUD_NAME = 'dl5oqxuo1';
        const CLOUDINARY_UPLOAD_PRESET = 'ash2026_upload';
        const MAX_FILE_SIZE = 10 * 1024 * 1024;
        
        // Admin password (simple protection - change this!)
        const ADMIN_PASSWORD = 'ash2026admin';
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function formatDateTime(timestamp) {
            if (!timestamp) return '';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const dateStr = date.toLocaleDateString('ms-MY');
            const timeStr = date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            return `${dateStr} ${timeStr}`;
        }
        
        function getMaxDuration(fileSize, duration) {
            const maxDuration = (MAX_FILE_SIZE / (fileSize / duration)) * 0.9;
            return Math.min(maxDuration, duration);
        }

        function ASH2026PhotoBook() {
            const [entries, setEntries] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [syncStatus, setSyncStatus] = useState('Loading...');
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [uploading, setUploading] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [isLocked, setIsLocked] = useState(false);
            
            const [newEntry, setNewEntry] = useState({
                uploaderName: '',
                caption: '',
                file: null,
                mediaType: null,
                trimmedBlob: null
            });
            
            const [videoPreviewUrl, setVideoPreviewUrl] = useState(null);
            const [videoDuration, setVideoDuration] = useState(0);
            const [trimStart, setTrimStart] = useState(0);
            const [trimEnd, setTrimEnd] = useState(0);
            const [maxAllowedDuration, setMaxAllowedDuration] = useState(0);
            const [needsTrimming, setNeedsTrimming] = useState(false);
            const [isTrimming, setIsTrimming] = useState(false);
            
            const fileInputRef = useRef(null);
            const videoRef = useRef(null);

            // Load cached name on mount
            useEffect(() => {
                const cachedName = localStorage.getItem('ash2026_uploaderName');
                if (cachedName) {
                    setNewEntry(prev => ({ ...prev, uploaderName: cachedName }));
                }
            }, []);

            useEffect(() => {
                setSyncStatus('üîÑ Loading memories...');
                
                // Check if photobook is locked
                db.collection('settings').doc('config').get().then((doc) => {
                    if (doc.exists) {
                        setIsLocked(doc.data().locked || false);
                    }
                });

                const unsubscribe = db.collection('photobook')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const loadedEntries = [];
                        snapshot.forEach((doc) => {
                            loadedEntries.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(loadedEntries);
                        setSyncStatus(`‚úÖ ${loadedEntries.length} memories loaded`);
                        setIsLoading(false);
                    }, (error) => {
                        console.error('Load error:', error);
                        setSyncStatus('‚ùå Failed to load');
                        setIsLoading(false);
                    });
                
                return () => unsubscribe();
            }, []);

            const handleAdminLogin = () => {
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    setShowAdminLogin(false);
                    setAdminPassword('');
                    alert('Admin mode activated! You can now lock/unlock the photobook.');
                } else {
                    alert('Wrong password!');
                }
            };

            const toggleLock = async () => {
                if (!isAdmin) {
                    setShowAdminLogin(true);
                    return;
                }
                
                const newLockState = !isLocked;
                try {
                    await db.collection('settings').doc('config').set({ 
                        locked: newLockState,
                        lockedBy: 'admin',
                        lockedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setIsLocked(newLockState);
                    alert(newLockState ? 'üîí Photobook LOCKED! No more uploads allowed.' : 'üîì Photobook UNLOCKED! Uploads enabled.');
                } catch (err) {
                    alert('Failed to toggle lock');
                }
            };

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.type.startsWith('video/')) {
                    const videoUrl = URL.createObjectURL(file);
                    setVideoPreviewUrl(videoUrl);
                    setNewEntry({ ...newEntry, file: file, mediaType: 'video' });
                    
                    const video = document.createElement('video');
                    video.preload = 'metadata';
                    video.onloadedmetadata = () => {
                        const duration = video.duration;
                        setVideoDuration(duration);
                        
                        if (file.size > MAX_FILE_SIZE) {
                            setNeedsTrimming(true);
                            const maxDur = getMaxDuration(file.size, duration);
                            setMaxAllowedDuration(maxDur);
                            setTrimStart(0);
                            setTrimEnd(Math.min(maxDur, duration));
                            alert(`Video too large (${(file.size/1024/1024).toFixed(1)}MB).\n\nMax allowed: ${formatTime(maxDur)} seconds\nPlease trim your video.`);
                        } else {
                            setNeedsTrimming(false);
                            setTrimStart(0);
                            setTrimEnd(duration);
                            setMaxAllowedDuration(duration);
                        }
                    };
                    video.src = videoUrl;
                } else {
                    if (file.size > MAX_FILE_SIZE) {
                        alert('Image too large! Max 10MB.');
                        return;
                    }
                    setNewEntry({ ...newEntry, file: file, mediaType: 'image', trimmedBlob: file });
                    setVideoPreviewUrl(null);
                    setNeedsTrimming(false);
                }
            };

            const trimVideo = async () => {
                if (!newEntry.file || !videoRef.current) return;
                
                setIsTrimming(true);
                setSyncStatus('‚úÇÔ∏è Trimming video...');
                
                try {
                    const video = videoRef.current;
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = Math.min(video.videoWidth, 1920);
                    canvas.height = Math.min(video.videoHeight, 1080) * (canvas.width / video.videoWidth);
                    
                    const stream = canvas.captureStream();
                    const mediaRecorder = new MediaRecorder(stream, {
                        mimeType: 'video/webm;codecs=vp9,opus',
                        videoBitsPerSecond: 2500000
                    });
                    
                    const chunks = [];
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) chunks.push(e.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'video/webm' });
                        const trimmedFile = new File([blob], 'trimmed-video.webm', { type: 'video/webm' });
                        
                        if (trimmedFile.size > MAX_FILE_SIZE) {
                            alert('Still too large. Please select shorter duration.');
                            setIsTrimming(false);
                            return;
                        }
                        
                        setNewEntry({ ...newEntry, trimmedBlob: trimmedFile });
                        setSyncStatus('‚úÖ Video trimmed!');
                        setIsTrimming(false);
                    };
                    
                    video.currentTime = trimStart;
                    
                    video.onseeked = () => {
                        mediaRecorder.start();
                        
                        const drawFrame = () => {
                            if (video.currentTime >= trimEnd || video.ended) {
                                mediaRecorder.stop();
                                return;
                            }
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            requestAnimationFrame(drawFrame);
                        };
                        
                        video.play();
                        drawFrame();
                    };
                    
                } catch (err) {
                    console.error('Trim error:', err);
                    alert('Gagal trim video.');
                    setIsTrimming(false);
                }
            };

            const uploadToCloudinary = async (file) => {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Upload failed');
                const data = await response.json();
                return {
                    url: data.secure_url,
                    type: data.resource_type === 'video' ? 'video' : 'image'
                };
            };

            const addEntry = async () => {
                if (!newEntry.uploaderName.trim()) {
                    alert('Sila masukkan nama!');
                    return;
                }
                
                // Cache the name for next time
                localStorage.setItem('ash2026_uploaderName', newEntry.uploaderName.trim());
                
                const fileToUpload = newEntry.trimmedBlob || newEntry.file;
                if (!fileToUpload) {
                    alert('Sila pilih foto/video!');
                    return;
                }

                if (fileToUpload.size > MAX_FILE_SIZE) {
                    alert(`File still too large (${(fileToUpload.size/1024/1024).toFixed(1)}MB).`);
                    return;
                }

                setUploading(true);
                setSyncStatus('‚¨ÜÔ∏è Uploading...');

                try {
                    const uploadResult = await uploadToCloudinary(fileToUpload);
                    
                    await db.collection('photobook').add({
                        uploaderName: newEntry.uploaderName.trim(),
                        caption: newEntry.caption.trim(),
                        mediaUrl: uploadResult.url,
                        mediaType: uploadResult.type,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        likes: 0,
                        originalDuration: videoDuration,
                        trimmedDuration: trimEnd - trimStart
                    });

                    setNewEntry(prev => ({ ...prev, caption: '', file: null, mediaType: null, trimmedBlob: null }));
                    setVideoPreviewUrl(null);
                    setVideoDuration(0);
                    setTrimStart(0);
                    setTrimEnd(0);
                    setNeedsTrimming(false);
                    setShowUploadModal(false);
                    setSyncStatus('‚úÖ Memory added!');
                } catch (err) {
                    console.error('Upload error:', err);
                    setSyncStatus('‚ùå Upload failed');
                    alert('Gagal upload: ' + err.message);
                } finally {
                    setUploading(false);
                }
            };

            const deleteEntry = async (entryId) => {
                if (!window.confirm('Padam memory ini?')) return;
                try {
                    await db.collection('photobook').doc(entryId).delete();
                    setSyncStatus('‚úÖ Memory deleted');
                } catch (err) {
                    alert('Gagal padam');
                }
            };

            const likeEntry = async (entryId, currentLikes) => {
                try {
                    await db.collection('photobook').doc(entryId).update({
                        likes: (currentLikes || 0) + 1
                    });
                } catch (err) {
                    console.error('Like error:', err);
                }
            };

            if (isLoading) {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center',
                    style: { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }
                }, React.createElement('div', { className: 'text-white text-2xl font-bold' }, 'üì∏ Loading...'));
            }

            return React.createElement('div', {
                className: 'min-h-screen p-4',
                style: { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }
            }, [
                React.createElement('div', { key: 'container', className: 'max-w-6xl mx-auto' }, [
                    // Header
                    React.createElement('div', {
                        key: 'header',
                        className: `text-center mb-8 bg-white/10 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-2 ${isLocked ? 'border-red-500' : 'border-yellow-400'}`
                    }, [
                        React.createElement('div', { key: 'title', className: 'flex items-center justify-center gap-3 mb-2' }, [
                            React.createElement('span', { key: 's1', className: 'text-4xl' }, '‚≠ê'),
                            React.createElement('h1', {
                                key: 'h1',
                                className: 'text-4xl sm:text-5xl font-black text-white',
                                style: { textShadow: '3px 3px 0px rgba(0,0,0,0.3)' }
                            }, 'ASH 2026'),
                            React.createElement('span', { key: 's2', className: 'text-4xl' }, '‚≠ê')
                        ]),
                        React.createElement('p', { key: 'p1', className: 'text-yellow-200 font-bold text-xl mb-2' }, 'Family Day Photo Book'),
                        React.createElement('p', { key: 'p2', className: 'text-white/80 text-sm' }, '7-8 Feb 2026 ‚Ä¢ Villa Zahra, A\'Famosa'),
                        React.createElement('p', { key: 'count', className: 'text-white/90 font-semibold mt-3' }, `üì∏ ${entries.length} memories`),
                        isLocked ? React.createElement('div', {
                            key: 'locked',
                            className: 'mt-3 bg-red-500/80 text-white px-4 py-2 rounded-full inline-block font-bold'
                        }, 'üîí LOCKED - View Only Mode') : null
                    ]),

                    React.createElement('div', {
                        key: 'status',
                        className: 'text-center mb-4 bg-white/10 backdrop-blur-sm rounded-xl p-3'
                    }, React.createElement('p', { className: 'text-white/90 text-sm font-semibold' }, syncStatus)),

                    // Controls
                    React.createElement('div', {
                        key: 'btns',
                        className: 'flex gap-3 mb-6 flex-wrap justify-center'
                    }, [
                        !isLocked ? React.createElement('button', {
                            key: 'up',
                            onClick: () => setShowUploadModal(true),
                            className: 'px-6 py-3 bg-green-500 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-transform'
                        }, 'üì§ Upload') : null,
                        
                        React.createElement('button', {
                            key: 'dl',
                            onClick: () => {
                                const html = `<!DOCTYPE html><html><head><style>body{font-family:Arial;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;margin:0}.container{max-width:1200px;margin:0 auto}.header{text-align:center;color:white;margin-bottom:30px}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.3)}.card img,.card video{width:100%;height:300px;object-fit:cover}.card-content{padding:15px}.uploader{font-weight:bold;color:#667eea}.datetime{font-size:0.85em;color:#666}.likes{color:#e74c3c;font-weight:bold}</style></head><body><div class="container"><div class="header"><h1>‚≠ê ASH 2026 ‚≠ê</h1><h2>Family Day Photo Book</h2><p>${entries.length} memories</p></div><div class="grid">${entries.map(e=>`<div class="card">${e.mediaType==='video'?`<video src="${e.mediaUrl}" controls></video>`:`<img src="${e.mediaUrl}" />`}<div class="card-content"><span class="uploader">üì∏ ${e.uploaderName}</span><p class="datetime">${e.timestamp ? new Date(e.timestamp.toDate()).toLocaleString('ms-MY', {hour12:true}) : ''}</p>${e.caption?`<p>${e.caption}</p>`:''}<p class="likes">‚ù§Ô∏è ${e.likes||0}</p></div></div>`).join('')}</div></div></body></html>`;
                                const blob = new Blob([html], {type:'text/html'});
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = `ASH2026-PhotoBook-FINAL-${new Date().toISOString().split('T')[0]}.html`;
                                a.click();
                                URL.revokeObjectURL(url);
                            },
                            className: 'px-6 py-3 bg-purple-600 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-transform'
                        }, isLocked ? 'üì• Download Final Book' : 'üì• Download'),
                        
                        // Admin lock button
                        React.createElement('button', {
                            key: 'lock',
                            onClick: toggleLock,
                            className: `px-4 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-transform ${isAdmin ? 'admin-badge text-gray-900' : 'bg-gray-600 text-white'}`
                        }, isAdmin ? (isLocked ? 'üîì Unlock' : 'üîí Lock') : 'üîê Admin')
                    ]),

                    // Admin login modal
                    showAdminLogin ? React.createElement('div', {
                        key: 'adminModal',
                        className: 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50'
                    }, React.createElement('div', { className: 'bg-white rounded-2xl p-6 max-w-sm w-full' }, [
                        React.createElement('h3', { key: 't', className: 'text-xl font-bold mb-4' }, 'Admin Login'),
                        React.createElement('input', {
                            key: 'p',
                            type: 'password',
                            value: adminPassword,
                            onChange: (e) => setAdminPassword(e.target.value),
                            placeholder: 'Enter password',
                            className: 'w-full px-4 py-2 border-2 border-gray-300 rounded-lg mb-4'
                        }),
                        React.createElement('div', { key: 'b', className: 'flex gap-2' }, [
                            React.createElement('button', {
                                onClick: handleAdminLogin,
                                className: 'flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg font-bold'
                            }, 'Login'),
                            React.createElement('button', {
                                onClick: () => { setShowAdminLogin(false); setAdminPassword(''); },
                                className: 'flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-bold'
                            }, 'Cancel')
                        ])
                    ])) : null,

                    // Empty state
                    entries.length === 0 ? React.createElement('div', {
                        key: 'empty',
                        className: 'text-center text-white py-20'
                    }, [
                        React.createElement('div', { key: 'i', className: 'text-6xl mb-4' }, 'üì∏'),
                        React.createElement('p', { key: 't1', className: 'text-xl font-bold' }, 'Belum ada memories lagi'),
                        !isLocked ? React.createElement('p', { key: 't2', className: 'text-white/70' }, 'Jadi yang pertama upload!') : null
                    ]) : null,

                    // Grid
                    React.createElement('div', {
                        key: 'grid',
                        className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6'
                    }, entries.map((entry) => React.createElement('div', {
                        key: entry.id,
                        className: 'bg-white rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl transition-all transform hover:scale-[1.02]'
                    }, [
                        React.createElement('div', {
                            key: 'media',
                            className: 'relative bg-gray-100',
                            style: { height: '300px' }
                        }, [
                            entry.mediaType === 'video' ? 
                                React.createElement('video', { key: 'v', src: entry.mediaUrl, controls: true, className: 'w-full h-full object-cover' }) :
                                React.createElement('img', { key: 'i', src: entry.mediaUrl, className: 'w-full h-full object-cover' }),
                            isAdmin ? React.createElement('button', {
                                key: 'd',
                                onClick: () => deleteEntry(entry.id),
                                className: 'absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg active:scale-95'
                            }, 'üóëÔ∏è') : null
                        ]),
                        React.createElement('div', { key: 'c', className: 'p-4' }, [
                            React.createElement('div', { key: 'm', className: 'flex items-center justify-between mb-2' }, [
                                React.createElement('span', { key: 'u', className: 'font-bold text-purple-700' }, `üë§ ${entry.uploaderName}`),
                                React.createElement('span', { key: 't', className: 'text-xs text-gray-500' }, formatDateTime(entry.timestamp))
                            ]),
                            entry.caption ? React.createElement('p', { key: 'cap', className: 'text-gray-700 mb-2 text-sm' }, entry.caption) : null,
                            entry.trimmedDuration ? React.createElement('p', { key: 'trim', className: 'text-xs text-gray-400 mb-2' }, `‚è±Ô∏è ${formatTime(entry.trimmedDuration)}s (trimmed)`) : null,
                            !isLocked ? React.createElement('button', {
                                key: 'l',
                                onClick: () => likeEntry(entry.id, entry.likes),
                                className: 'text-red-500 font-bold flex items-center gap-2 active:scale-95 transition-transform'
                            }, `‚ù§Ô∏è ${entry.likes || 0}`) : React.createElement('span', { key: 'l', className: 'text-red-500 font-bold' }, `‚ù§Ô∏è ${entry.likes || 0}`)
                        ])
                    ]))),

                    // Footer
                    React.createElement('div', {
                        key: 'foot',
                        className: 'mt-8 text-center text-white/80 text-sm'
                    }, isLocked ? 'üîí Photobook finalized. View and download only.' : 'üí° Auto-refresh real-time ‚Ä¢ Name auto-saved for next upload'),

                    // Upload Modal
                    !isLocked && showUploadModal ? React.createElement('div', {
                        key: 'modal',
                        className: 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto'
                    }, React.createElement('div', { className: 'bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto' }, [
                        React.createElement('div', { key: 'h', className: 'flex justify-between items-center mb-4' }, [
                            React.createElement('h3', { className: 'text-2xl font-black text-purple-700' }, 'Upload Memory'),
                            React.createElement('button', {
                                onClick: () => { 
                                    setShowUploadModal(false); 
                                    setNewEntry(prev => ({ ...prev, caption: '', file: null, mediaType: null, trimmedBlob: null }));
                                    setVideoPreviewUrl(null);
                                    setNeedsTrimming(false);
                                },
                                className: 'text-gray-500 text-2xl font-bold'
                            }, '‚úï')
                        ]),
                        
                        React.createElement('div', { key: 'f', className: 'space-y-4' }, [
                            // Name input with clear button
                            React.createElement('div', { key: 'nameWrap', className: 'relative' }, [
                                React.createElement('input', {
                                    type: 'text',
                                    value: newEntry.uploaderName,
                                    onChange: (e) => setNewEntry({ ...newEntry, uploaderName: e.target.value }),
                                    placeholder: 'Nama Anda *',
                                    className: 'w-full px-4 py-2 border-2 border-purple-300 rounded-lg pr-10'
                                }),
                                newEntry.uploaderName ? React.createElement('button', {
                                    onClick: () => setNewEntry({ ...newEntry, uploaderName: '' }),
                                    className: 'absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 font-bold'
                                }, '‚úï') : null
                            ]),
                            newEntry.uploaderName ? React.createElement('p', { key: 'saved', className: 'text-xs text-green-600' }, '‚úì Name will be saved for next time') : null,
                            
                            React.createElement('textarea', {
                                value: newEntry.caption,
                                onChange: (e) => setNewEntry({ ...newEntry, caption: e.target.value }),
                                placeholder: 'Caption (optional)',
                                className: 'w-full px-4 py-2 border-2 border-purple-300 rounded-lg',
                                rows: 2
                            }),
                            
                            React.createElement('input', {
                                ref: fileInputRef,
                                type: 'file',
                                accept: 'image/*,video/*',
                                onChange: handleFileSelect,
                                className: 'hidden'
                            }),
                            !newEntry.file ? React.createElement('button', {
                                onClick: () => fileInputRef.current?.click(),
                                className: 'w-full px-4 py-3 border-2 border-dashed border-purple-300 rounded-lg font-bold text-purple-700 bg-purple-50'
                            }, 'üì§ Select Photo/Video (Max 10MB)') : null,
                            
                            newEntry.file ? React.createElement('div', { key: 'fileinfo', className: 'bg-gray-100 p-3 rounded-lg' }, [
                                React.createElement('p', { key: 'n', className: 'font-bold text-sm' }, newEntry.file.name),
                                React.createElement('p', { key: 's', className: 'text-xs text-gray-600' }, `Size: ${(newEntry.file.size/1024/1024).toFixed(2)}MB`),
                                newEntry.mediaType === 'video' && videoDuration > 0 ? React.createElement('p', { key: 'd', className: 'text-xs text-gray-600' }, `Duration: ${formatTime(videoDuration)}`) : null,
                                needsTrimming ? React.createElement('p', { key: 'w', className: 'text-xs text-red-600 font-bold mt-1' }, `‚ö†Ô∏è Max allowed: ${formatTime(maxAllowedDuration)}`) : null
                            ]) : null,
                            
                            videoPreviewUrl && newEntry.mediaType === 'video' ? React.createElement('div', { key: 'trim', className: 'space-y-3' }, [
                                React.createElement('video', {
                                    ref: videoRef,
                                    src: videoPreviewUrl,
                                    className: 'w-full rounded-lg',
                                    style: { maxHeight: '200px' },
                                    controls: true
                                }),
                                
                                needsTrimming ? React.createElement('div', { key: 'trimcontrols', className: 'bg-yellow-50 p-3 rounded-lg border border-yellow-300' }, [
                                    React.createElement('p', { key: 'l', className: 'text-sm font-bold text-yellow-800 mb-2' }, '‚úÇÔ∏è Trim Video:'),
                                    React.createElement('div', { key: 'sliders', className: 'space-y-2' }, [
                                        React.createElement('div', { key: 'start', className: 'flex items-center gap-2' }, [
                                            React.createElement('span', { className: 'text-xs w-12' }, 'Start:'),
                                            React.createElement('input', {
                                                type: 'range',
                                                min: 0,
                                                max: videoDuration - 1,
                                                step: 0.1,
                                                value: trimStart,
                                                onChange: (e) => {
                                                    const val = parseFloat(e.target.value);
                                                    setTrimStart(val);
                                                    if (val >= trimEnd) setTrimEnd(Math.min(val + 1, videoDuration));
                                                },
                                                className: 'flex-1 trim-slider'
                                            }),
                                            React.createElement('span', { className: 'text-xs w-12 text-right' }, formatTime(trimStart))
                                        ]),
                                        React.createElement('div', { key: 'end', className: 'flex items-center gap-2' }, [
                                            React.createElement('span', { className: 'text-xs w-12' }, 'End:'),
                                            React.createElement('input', {
                                                type: 'range',
                                                min: trimStart + 0.5,
                                                max: Math.min(videoDuration, trimStart + maxAllowedDuration),
                                                step: 0.1,
                                                value: trimEnd,
                                                onChange: (e) => setTrimEnd(parseFloat(e.target.value)),
                                                className: 'flex-1 trim-slider'
                                            }),
                                            React.createElement('span', { className: 'text-xs w-12 text-right' }, formatTime(trimEnd))
                                        ])
                                    ]),
                                    React.createElement('p', { key: 'sel', className: 'text-sm text-center font-bold text-purple-700 mt-2' }, 
                                        `Selected: ${formatTime(trimEnd - trimStart)} seconds`
                                    ),
                                    React.createElement('button', {
                                        onClick: trimVideo,
                                        disabled: isTrimming || newEntry.trimmedBlob,
                                        className: 'w-full mt-2 px-4 py-2 bg-yellow-500 text-white rounded-lg font-bold disabled:opacity-50 disabled:bg-green-500'
                                    }, isTrimming ? '‚úÇÔ∏è Trimming...' : newEntry.trimmedBlob ? '‚úÖ Trimmed!' : '‚úÇÔ∏è Trim Video Now')
                                ]) : null
                            ]) : null,
                            
                            newEntry.file && newEntry.mediaType === 'image' ? React.createElement('img', {
                                src: URL.createObjectURL(newEntry.file),
                                className: 'w-full h-40 object-cover rounded-lg'
                            }) : null,
                            
                            React.createElement('button', {
                                onClick: addEntry,
                                disabled: uploading || (needsTrimming && !newEntry.trimmedBlob),
                                className: 'w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed'
                            }, uploading ? '‚¨ÜÔ∏è Uploading...' : needsTrimming && !newEntry.trimmedBlob ? '‚ö†Ô∏è Trim video first' : 'üì§ Upload Memory')
                        ])
                    ])) : null
                ])
            ]);
        }

        const root = ReactDOM.createRoot ? ReactDOM.createRoot(document.getElementById('root')) : ReactDOM;
        if (root.render) root.render(React.createElement(ASH2026PhotoBook));
        else ReactDOM.render(React.createElement(ASH2026PhotoBook), document.getElementById('root'));
    </script>
</body>
</html>