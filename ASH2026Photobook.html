<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ASH 2026 Photo Book - LIVE & SHARED</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        button { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        input, button, textarea { font-size: 16px; }
        .upload-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useEffect, useRef, useCallback } = React;
        
        // Your Firebase Config - ACTUAL CREDENTIALS
        const firebaseConfig = {
            apiKey: "AIzaSyB8j-jHo2N341ieW4AVCdPL3ipn4Ss8sYQ",
            authDomain: "ash-2026-photobook.firebaseapp.com",
            projectId: "ash-2026-photobook",
            storageBucket: "ash-2026-photobook.firebasestorage.app",
            messagingSenderId: "328228907150",
            appId: "1:328228907150:web:fb4d2780b40bb8403ec1df",
            measurementId: "G-783K226XC4"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Cloudinary Config
        const CLOUDINARY_CLOUD_NAME = 'dl5oqxuo1';
        const CLOUDINARY_UPLOAD_PRESET = 'ash2026_upload';
        
        function ASH2026PhotoBook() {
            const [entries, setEntries] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [syncStatus, setSyncStatus] = useState('Loading...');
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [uploading, setUploading] = useState(false);
            const [newEntry, setNewEntry] = useState({
                uploaderName: '',
                caption: '',
                mediaUrl: null,
                mediaType: null
            });
            const fileInputRef = useRef(null);

            // Load entries from Firestore
            const loadPhotoBook = useCallback(() => {
                setSyncStatus('üîÑ Loading memories...');
                
                db.collection('photobook')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const loadedEntries = [];
                        snapshot.forEach((doc) => {
                            loadedEntries.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(loadedEntries);
                        setSyncStatus(`‚úÖ ${loadedEntries.length} memories loaded`);
                        setIsLoading(false);
                    }, (error) => {
                        console.error('Load error:', error);
                        setSyncStatus('‚ùå Failed to load');
                        setIsLoading(false);
                    });
            }, []);

            useEffect(() => {
                loadPhotoBook();
            }, [loadPhotoBook]);

            // Upload to Cloudinary
            const uploadToCloudinary = async (file) => {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                formData.append('cloud_name', CLOUDINARY_CLOUD_NAME);

                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const data = await response.json();
                return {
                    url: data.secure_url,
                    type: data.resource_type === 'video' ? 'video' : 'image'
                };
            };

            const addEntry = async () => {
                if (!newEntry.uploaderName.trim() || !newEntry.file) {
                    alert('Sila masukkan nama dan pilih foto/video!');
                    return;
                }

                setUploading(true);
                setSyncStatus('‚¨ÜÔ∏è Uploading to cloud...');

                try {
                    // Upload to Cloudinary first
                    const uploadResult = await uploadToCloudinary(newEntry.file);
                    
                    // Save metadata to Firestore
                    const entry = {
                        uploaderName: newEntry.uploaderName.trim(),
                        caption: newEntry.caption.trim(),
                        mediaUrl: uploadResult.url,
                        mediaType: uploadResult.type,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        likes: 0
                    };

                    await db.collection('photobook').add(entry);

                    setNewEntry({
                        uploaderName: '',
                        caption: '',
                        mediaUrl: null,
                        mediaType: null,
                        file: null
                    });
                    setShowUploadModal(false);
                    setSyncStatus('‚úÖ Memory added!');
                } catch (err) {
                    console.error('Upload error:', err);
                    setSyncStatus('‚ùå Upload failed');
                    alert('Gagal upload: ' + err.message);
                } finally {
                    setUploading(false);
                }
            };

            const deleteEntry = async (entryId) => {
                if (!window.confirm('Padam memory ini?')) return;
                
                try {
                    await db.collection('photobook').doc(entryId).delete();
                    setSyncStatus('‚úÖ Memory deleted');
                } catch (err) {
                    console.error('Delete error:', err);
                    alert('Gagal padam');
                }
            };

            const likeEntry = async (entryId, currentLikes) => {
                try {
                    await db.collection('photobook').doc(entryId).update({
                        likes: (currentLikes || 0) + 1
                    });
                } catch (err) {
                    console.error('Like error:', err);
                }
            };

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.size > 10 * 1024 * 1024) {
                    alert('File terlalu besar! Max 10MB.');
                    return;
                }

                setNewEntry({
                    ...newEntry,
                    file: file,
                    mediaType: file.type.startsWith('video/') ? 'video' : 'image'
                });
            };

            const downloadPhotoBook = () => {
                const htmlContent = `<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>ASH 2026 Family Day - Photo Book</title>
    <style>
        body { font-family: Arial; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .card img, .card video { width: 100%; height: 300px; object-fit: cover; }
        .card-content { padding: 15px; }
        .uploader { font-weight: bold; color: #667eea; }
        .date { font-size: 0.85em; color: #666; }
        .caption { margin: 10px 0; color: #333; }
        .likes { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚≠ê ASH 2026 ‚≠ê</h1>
            <h2>Family Day Photo Book</h2>
            <p>7-8 Feb 2026 ‚Ä¢ Villa Zahra, A'Famosa</p>
            <p>${entries.length} memories captured</p>
        </div>
        <div class="grid">
            ${entries.map(entry => `
                <div class="card">
                    ${entry.mediaType === 'video' 
                        ? \`<video src="\${entry.mediaUrl}" controls></video>\`
                        : \`<img src="\${entry.mediaUrl}" alt="\${entry.caption}" />\`
                    }
                    <div class="card-content">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="uploader">üì∏ \${entry.uploaderName}</span>
                            <span class="date">\${entry.timestamp ? new Date(entry.timestamp.toDate()).toLocaleDateString('ms-MY') : ''}</span>
                        </div>
                        \${entry.caption ? \`<p class="caption">\${entry.caption}</p>\` : ''}
                        <p class="likes">‚ù§Ô∏è \${entry.likes || 0} likes</p>
                    </div>
                </div>
            \`).join('')}
        </div>
    </div>
</body>
</html>`;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ASH2026-PhotoBook-${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            if (isLoading) {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center',
                    style: { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }
                }, React.createElement('div', { className: 'text-white text-2xl font-bold' }, 'üì∏ Loading memories...'));
            }

            // Main render
            return React.createElement('div', {
                className: 'min-h-screen p-4',
                style: { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }
            }, [
                React.createElement('div', { key: 'container', className: 'max-w-6xl mx-auto' }, [
                    // Header
                    React.createElement('div', {
                        key: 'header',
                        className: 'text-center mb-8 bg-white/10 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-2 border-yellow-400'
                    }, [
                        React.createElement('div', { key: 'title-row', className: 'flex items-center justify-center gap-3 mb-2' }, [
                            React.createElement('span', { key: 's1', className: 'text-4xl' }, '‚≠ê'),
                            React.createElement('h1', {
                                key: 'h1',
                                className: 'text-4xl sm:text-5xl font-black text-white',
                                style: { textShadow: '3px 3px 0px rgba(0,0,0,0.3)' }
                            }, 'ASH 2026'),
                            React.createElement('span', { key: 's2', className: 'text-4xl' }, '‚≠ê')
                        ]),
                        React.createElement('p', { key: 'sub1', className: 'text-yellow-200 font-bold text-xl mb-2' }, 'Family Day Photo Book'),
                        React.createElement('p', { key: 'sub2', className: 'text-white/80 text-sm' }, '7-8 Feb 2026 ‚Ä¢ Villa Zahra, A\'Famosa'),
                        React.createElement('p', { key: 'count', className: 'text-white/90 font-semibold mt-3' }, `üì∏ ${entries.length} memories captured`)
                    ]),

                    // Status
                    React.createElement('div', {
                        key: 'status',
                        className: 'text-center mb-4 bg-white/10 backdrop-blur-sm rounded-xl p-3'
                    }, React.createElement('p', { className: 'text-white/90 text-sm font-semibold' }, syncStatus)),

                    // Controls
                    React.createElement('div', {
                        key: 'ctrls',
                        className: 'flex gap-3 mb-6 flex-wrap justify-center'
                    }, [
                        React.createElement('button', {
                            key: 'upload',
                            onClick: () => setShowUploadModal(true),
                            className: 'px-6 py-3 bg-green-500 text-white rounded-xl font-bold shadow-lg transition-transform active:scale-95'
                        }, 'üì§ Upload'),
                        React.createElement('button', {
                            key: 'refresh',
                            onClick: () => loadPhotoBook(),
                            className: 'px-6 py-3 bg-blue-400 text-gray-900 rounded-xl font-bold shadow-lg transition-transform active:scale-95'
                        }, 'üîÑ Refresh'),
                        React.createElement('button', {
                            key: 'download',
                            onClick: downloadPhotoBook,
                            className: 'px-6 py-3 bg-purple-600 text-white rounded-xl font-bold shadow-lg transition-transform active:scale-95'
                        }, 'üì• Download')
                    ]),

                    // Empty state
                    entries.length === 0 ? React.createElement('div', {
                        key: 'empty',
                        className: 'text-center text-white py-20'
                    }, [
                        React.createElement('div', { key: 'icon', className: 'text-6xl mb-4' }, 'üì∏'),
                        React.createElement('p', { key: 't1', className: 'text-xl font-bold mb-2' }, 'Belum ada memories lagi'),
                        React.createElement('p', { key: 't2', className: 'text-white/70' }, 'Jadi yang pertama upload foto atau video!')
                    ]) : null,

                    // Grid
                    React.createElement('div', {
                        key: 'grid',
                        className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6'
                    }, entries.map((entry) => React.createElement('div', {
                        key: entry.id,
                        className: 'bg-white rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl transition-all transform hover:scale-[1.02]'
                    }, [
                        React.createElement('div', {
                            key: 'media',
                            className: 'relative bg-gray-100',
                            style: { height: '300px' }
                        }, [
                            entry.mediaType === 'video' ? 
                                React.createElement('video', {
                                    key: 'vid',
                                    src: entry.mediaUrl,
                                    controls: true,
                                    className: 'w-full h-full object-cover'
                                }) :
                                React.createElement('img', {
                                    key: 'img',
                                    src: entry.mediaUrl,
                                    alt: entry.caption,
                                    className: 'w-full h-full object-cover'
                                }),
                            React.createElement('button', {
                                key: 'del',
                                onClick: () => deleteEntry(entry.id),
                                className: 'absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg active:scale-95 transition-transform'
                            }, 'üóëÔ∏è')
                        ]),
                        React.createElement('div', { key: 'content', className: 'p-4' }, [
                            React.createElement('div', {
                                key: 'meta',
                                className: 'flex items-center justify-between mb-3'
                            }, [
                                React.createElement('div', { key: 'user', className: 'flex items-center gap-2' }, [
                                    React.createElement('span', { className: 'text-purple-600' }, 'üë§'),
                                    React.createElement('span', { className: 'font-bold text-purple-700' }, entry.uploaderName)
                                ]),
                                React.createElement('div', {
                                    key: 'date',
                                    className: 'text-sm text-gray-500'
                                }, entry.timestamp ? new Date(entry.timestamp.toDate()).toLocaleDateString('ms-MY') : '')
                            ]),
                            entry.caption ? React.createElement('p', {
                                key: 'cap',
                                className: 'text-gray-700 mb-3 text-sm'
                            }, entry.caption) : null,
                            React.createElement('div', {
                                key: 'footer',
                                className: 'flex items-center justify-between'
                            }, [
                                React.createElement('button', {
                                    key: 'like',
                                    onClick: () => likeEntry(entry.id, entry.likes),
                                    className: 'flex items-center gap-2 text-red-500 active:text-red-600 transition-colors font-bold'
                                }, ['‚ù§Ô∏è ', React.createElement('span', { key: 'c' }, entry.likes || 0)]),
                                React.createElement('span', {
                                    key: 'time',
                                    className: 'text-xs text-gray-400'
                                }, entry.timestamp ? new Date(entry.timestamp.toDate()).toLocaleTimeString('ms-MY', { hour: '2-digit', minute: '2-digit' }) : '')
                            ])
                        ])
                    ]))),

                    // Footer
                    React.createElement('div', {
                        key: 'foot',
                        className: 'mt-8 text-center text-white/80 text-sm'
                    }, 'üí° Auto-refresh real-time ‚Ä¢ Boleh download untuk simpan forever!'),

                    // Upload Modal
                    showUploadModal ? React.createElement('div', {
                        key: 'modal',
                        className: 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50'
                    }, React.createElement('div', {
                        className: 'bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl'
                    }, [
                        React.createElement('div', {
                            key: 'header',
                            className: 'flex justify-between items-center mb-4'
                        }, [
                       
